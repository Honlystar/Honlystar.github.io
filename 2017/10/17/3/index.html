<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable"  content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no">
    <link rel="dns-prefetch" href="//t11.baidu.com">
    <!--Title-->



    <link rel="alternate" href="/atom.xml" title="星空守候的博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

<title>promise的初步使用 | 星空守候的博客</title>
    <!--SEO-->

<meta name="description" content="这是属于星空守候的专属个人空间，这里是web开发工程师的天堂，这里欢迎每一个开发者，希望你们在这里有所提高"/>


<meta name="keyword" content="星空守候,rain,博客,web前端,移动开发工程师,vue开发,程序员,微信"/>



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
<!-- 百度网站收录认证 -->
<meta name="baidu-site-verification" content="bKjURLBoKJ" />
    




    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css?rev=9.12.0">


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    


    
    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="branding" href="/" title="">
            <img src="/img/header_logo.png" alt="Snippet 博客主题">
        </a>
        <h2 class="text-hide">Snippet主题</h2>
        <img src="/img/header_logo.png" alt="Snippet 博客主题" class="hide">
    </div>
</header>
<script src="https://cdn.bootcss.com/jquery/1.3.1/jquery.js"></script>
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script>
    var APP_ID = 'B6OdBOupoWFzPHVFenzSRxxc-gzGzoHsz';
    var APP_KEY = 'l8Yl2pLhmnrGNUfSxnCShquI';
    AV.init({
        appId: APP_ID,
        appKey: APP_KEY
    });
    // 显示次数
    function showTime(Counter,url) {
        var query = new AV.Query("Counter");
        if($(".leancloud_anaylytics").length > 0){
            //var url = $(".leancloud_anaylytics").attr('id').trim();
            // where field
            query.equalTo("words", url);
            // count 
            query.count().then(function (number) {
                // There are number instances of MyClass where words equals url.
                $(document.getElementById(url)).text(number?  number : '--');
            }, function (error) {
                // error is an instance of AVError.
            });
        }
    }
   // 追加pv
    function addCount(Counter,url) {
        //var url = $(".leancloud_anaylytics").length > 0 ? $(".leancloud_anaylytics").attr('id').trim() : 'icafebolger.com';
        var Counter = AV.Object.extend("Counter");
        var query = new Counter;
        query.save({
            words: url
        }).then(function (object) {
        })
    }
</script>


<!-- 站内搜索 -->
<script type="text/javascript" id="hexo.configuration">
    var CONFIG = {
      root: '/',
      algolia: {
            applicationID: 'MU56WVFS7Y',
            apiKey: 'ac191a79926244d940feac237c708a4c',
            indexName: 'onlystar_blog',
            hits: {"per_page":10},
            labels: {"input_placeholder":"搜索...",
            "hits_empty":"未发现与 ${query} 相关的内容",
            "hits_stats":"${hits} 条相关条目，使用了 ${time} 毫秒"}
          }
    };
  </script>

    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            
                                <li role="presentation"><a href="/" >首页</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/web/" >前端</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/Webpack/" >webpack</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/ES6/" >ES6</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/vue/" >vue</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/weex/" >weex</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/PS/" >PS</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/nodeJS/" >nodeJS</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/wechat/" >微信</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/pages/" >个人网站</a></li>
                            
                        
                            
                                <li role="presentation"><a href="/categories/about/" >关于</a></li>
                            
                        
                        <!-- 是否开启搜索 -->
                        
                            <li role="presentation" class="">
                                <a href="javascript:void(0)" class="popup-trigger">搜索</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="promise的初步使用">
            
            promise的初步使用
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>ES6</span>
    </span>
    
    
        &nbsp;&nbsp;
        
            <span class="fa-wrap">
                <i class="fa fa-tags"></i>
                <span class="tags-meta">
                    
                    js
                    
                </span>
            </span>
        
            <span class="fa-wrap">
                <i class="fa fa-tags"></i>
                <span class="tags-meta">
                    
                    promise
                    
                </span>
            </span>
        
    
    &nbsp;&nbsp;
    <span class="fa-wrap">
            <i class="fa fa-user-o"></i>
            <span class="date-meta"><b>徐辉波</b></span>
    </span>
    
        <span class="fa-wrap">
                <i class="fa fa-hand-pointer-o"></i>
                <span id="/2017/10/17/3/" class="date-meta leancloud_anaylytics" data-flag-title="promise的初步使用">0</span>次
        </span>
        <script>
                var Counter = AV.Object.extend("Counter");
                addCount(Counter,"/2017/10/17/3/");
                showTime(Counter,"/2017/10/17/3/");
        </script>      
    
    &nbsp;&nbsp;
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2017/10/17</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body">
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在前端开发中，经常会遇到这样的困境：一个接口的参数会需要使用另一个接口获取，这时候聪明的做法就是使用回调函数，这样就可以解决问题，但是这种做法增加了函数的嵌套深度，如果需要的是好几个接口的返回数据,这样层层的回调,就比较头疼痛了，这就是所谓的回调地狱。Promise正是在这种情况下应运而生,它完美优雅的解决了回调地狱难题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">step1(function (value1) &#123;</div><div class="line">  step2(value1, function(value2)&#123;</div><div class="line">    step3(value2,function(value3) &#123;</div><div class="line">      step4(value3,function(value4) &#123;</div><div class="line">        // ...</div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<blockquote>
<p>Promise 是异步编程的一种解决方案，Promise 可以认为是一个对象，它可以获取异步操的最终完成（或失败）及其结果值的表示</p>
</blockquote>
<ul>
<li>Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（成功时）和rejected（失败时）</li>
<li>Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected.</li>
</ul>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>ES6 规定，Promise对象是一个构造函数，用来生成Promise实例,该函数的两个参数分别是两个函数resolve和reject<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var promise = new Promise(function(resolve, reject) &#123;</div><div class="line"> if (/* 异步操作成功 */)&#123;</div><div class="line"> resolve(value);</div><div class="line"> &#125; else &#123;</div><div class="line"> reject(error);</div><div class="line"> &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="then方法"><a href="#then方法" class="headerlink" title="then方法"></a>then方法</h3><p>then方法是定义在原型对象Promise.prototype上的。它的作用是为 Promise 实例添加状态改变时的回调函数,then方法返回的是一个新的Promise实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">promise.then(function(value) &#123;</div><div class="line"> // success</div><div class="line">&#125;, function(value) &#123;</div><div class="line"> // failure</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>如果异步操作成功，则用 resolve 方法将状态从“未完成”变为“成功”，如果异步操作失败，则用 reject方法将状态从“未完成”变为“失败”</p>
<p>这里是promised基本使用的一个demo,定义做饭，吃饭,洗碗三个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">//做饭</div><div class="line">function cook()&#123;</div><div class="line">    console.log(&apos;开始做饭。&apos;);</div><div class="line">    var p = new Promise(function(resolve, reject)&#123;</div><div class="line">        console.log(&apos;做饭完毕！&apos;);</div><div class="line">        resolve(&apos;鸡蛋炒饭&apos;);</div><div class="line">    &#125;);</div><div class="line">    return p;</div><div class="line">&#125;</div><div class="line">//吃饭</div><div class="line">function eat(data)&#123;</div><div class="line">    console.log(&apos;开始吃饭：&apos; + data);</div><div class="line">    var p = new Promise(function(resolve, reject)&#123; </div><div class="line">        console.log(&apos;吃饭完毕!&apos;);</div><div class="line">        resolve(&apos;一块碗和一双筷子&apos;);</div><div class="line">    &#125;);</div><div class="line">    return p;</div><div class="line">&#125;</div><div class="line">//洗碗</div><div class="line">function wash(data)&#123;</div><div class="line">    console.log(&apos;开始洗碗：&apos; + data);</div><div class="line">    var p = new Promise(function(resolve, reject)&#123; </div><div class="line">            console.log(&apos;洗碗完毕!&apos;);</div><div class="line">            resolve(&apos;干净的碗筷&apos;);</div><div class="line">    &#125;);</div><div class="line">    return p;</div><div class="line">&#125;</div><div class="line">//调用三个过程</div><div class="line">cook()</div><div class="line">.then(function(data)&#123;</div><div class="line">    return eat(data);</div><div class="line">&#125;)</div><div class="line">.then(function(data)&#123;</div><div class="line">    return wash(data);</div><div class="line">&#125;)</div><div class="line">.then(function(data)&#123;</div><div class="line">    console.log(data);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>程序成功运行的结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">开始做饭。</div><div class="line">做饭完毕！</div><div class="line">开始吃饭：鸡蛋炒饭</div><div class="line">吃饭完毕!</div><div class="line">开始洗碗：一块碗和一双筷子</div><div class="line">洗碗完毕!</div><div class="line">干净的碗筷</div></pre></td></tr></table></figure></p>
<h3 id="all方法"><a href="#all方法" class="headerlink" title="all方法"></a>all方法</h3><p>有时候需要多个异步任务全部执行完成后再执行后面的操作，这时候就需要用到Promise.all()，它接收一个Promise的对象的数组作为参数，当这个数组里的所有Promise对象全部变成resolve或者reject的时候，它才会去调用后面的.then()。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Promise</div><div class="line">.all([cook(), eat(),wash()])</div><div class="line">.then(function(results)&#123;</div><div class="line">    console.log(results);</div><div class="line">    console.log(&quot;做吃洗完毕：&quot;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>成功的运行结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">开始做饭。</div><div class="line">做饭完毕！</div><div class="line">开始吃饭：undefined</div><div class="line">吃饭完毕!</div><div class="line">开始洗碗：undefined</div><div class="line">洗碗完毕!</div><div class="line">做吃洗完毕：</div><div class="line">[&quot;鸡蛋炒饭&quot;, &quot;一块碗和一双筷子&quot;, &quot;干净的碗筷&quot;]</div></pre></td></tr></table></figure></p>

    </div>

    <div class="post-footer">   
        <div>
            
                转载声明: 商业转载请联系作者获得授权,非商业转载请注明出处 © Snippet
            
        </div>
        <div>
            
                版权声明: <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">
知识共享署名-非商业性使用-禁止演绎 3.0 未本地化版本许可协议（CC BY-NC-ND 3.0）
</a>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2017/10/15/1/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2146519"></script>








    </div>





                </main>
                
    <aside class="col-md-4 sidebar">
        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>gitHub是一个面向开源的项目托管平台<br/>
我的github主页：<a href="http://www.onlystar.site" title="fork me" target="_blank">onlystar</a> <br/>
<hr/>这里可以学到有用的东西，欢迎大家一起来交流。<br/>我的CSDN：<a href="http://blog.csdn.net/qq_26764181" target="_blank">来瞧瞧吧</a>
</p>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">社交</h3> 
        <div class="content social">
            
	            <a href="//github.com/Xonlystar" rel="external nofollow" title="Github" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="//shang.qq.com/email/stop/email_stop.html?qq=991923257&sig=f2c204362756cc0852239717e4e89419e9ad82a82c12271d&tttt=1" rel="external nofollow" title="联系QQ" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="微博" target="_blank">
			    	<i class="weibo fa fa-weibo"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="微信" target="_blank">
			    	<i class="weixin fa fa-weixin"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="简书" target="_blank">
			    	<i class="lastfm fa fa-lastfm"></i>
			    </a>
            
        </div>
    </div>


        
        
    <div class="widget">
        <h3 class="title">分类</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link current" href="/categories/ES6/"><i class="fa" aria-hidden="true">ES6</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Webpack/"><i class="fa" aria-hidden="true">Webpack</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/"><i class="fa" aria-hidden="true">前端</i></a><span class="category-list-count">1</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">归档</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/"><i class="fa" aria-hidden="true">十月 2017</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">九月 2017</i></a><span class="archive-list-count">1</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">标签云</h3>
    <div class="content tag-cloud">
      <!-- 
        <a href="undefinedtags/测试/" style="font-size: 1em;">测试</a> <a href="undefinedtags/webpack/" style="font-size: 1em;">webpack</a> <a href="undefinedtags/js/" style="font-size: 1em;">js</a> <a href="undefinedtags/promise/" style="font-size: 1em;">promise</a> <a href="undefinedtags/only/" style="font-size: 1em;">only</a> -->
        
          <a href="/tags/测试" style="font-size: 1em;">测试</a>
      
          <a href="/tags/webpack" style="font-size: 1em;">webpack</a>
      
          <a href="/tags/js" style="font-size: 1em;">js</a>
      
          <a href="/tags/promise" style="font-size: 1em;">promise</a>
      
          <a href="/tags/only" style="font-size: 1em;">only</a>
      
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">友链</h3>
        <div class="content friends-link">
        
            <a href="http://www.cnblogs.com/wisemen/" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<div class="site-search">
    <div class="algolia-popup popup">
        <div class="algolia-search">
        <div class="algolia-search-input-icon">
            <i class="fa fa-search"></i>
        </div>
        <div class="algolia-search-input" id="algolia-search-input"></div>
        </div>

        <div class="algolia-results">
        <div id="algolia-stats"></div>
        <div id="algolia-hits"></div>
        <div id="algolia-pagination" class="algolia-pagination"></div>
        </div>

        <span class="popup-btn-close">
        <i class="fa fa-times-circle"></i>
        </span>
    </div>
</div>
<script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script>

<script type="text/javascript">
$(document).ready(function () {
  //导航
  $("#main-menu ul.menu>li>a").each(function(key,value){
      var url=window.location.href.slice(window.location.href.indexOf("categories")-1);
      if(($(value).attr("href")=="/"&&key==0)||(url==$(value).attr("href"))){
        $(value).parent().siblings().find("a").removeClass("curr");
        $(value).removeClass("curr").addClass("curr");
        return;
      }
  });

  //站内搜索
  var algoliaSettings = CONFIG.algolia;
  var isAlgoliaSettingsValid = algoliaSettings.applicationID &&
    algoliaSettings.apiKey &&
    algoliaSettings.indexName;

  if (!isAlgoliaSettingsValid) {
    window.console.error('Algolia Settings are invalid.');
    return;
  }

  var search = instantsearch({
    appId: algoliaSettings.applicationID,
    apiKey: algoliaSettings.apiKey,
    indexName: algoliaSettings.indexName,
    searchFunction: function (helper) {
      var searchInput = $('#algolia-search-input').find('input');

      if (searchInput.val()) {
        helper.search();
      }
    }
  });

  // Registering Widgets
  [
    instantsearch.widgets.searchBox({
      container: '#algolia-search-input',
      placeholder: algoliaSettings.labels.input_placeholder
    }),

    instantsearch.widgets.hits({
      container: '#algolia-hits',
      hitsPerPage: algoliaSettings.hits.per_page || 10,
      templates: {
        item: function (data) {
          var date=new Date(data.date).toISOString().slice(0,10).replace(/-/g,"/");
          var url=CONFIG.root+date+"/"+data.slug;
          return (

            '<a href="' + url + '" class="algolia-hit-item-link">' +
            data._highlightResult.title.value +
            '</a>'
          );
        },
        empty: function (data) {
          return (
            '<div id="algolia-hits-empty">' +
            algoliaSettings.labels.hits_empty.replace(/\$\{query}/, data.query) +
            '</div>'
          );
        }
      },
      cssClasses: {
        item: 'algolia-hit-item'
      }
    }),

    instantsearch.widgets.stats({
      container: '#algolia-stats',
      templates: {
        body: function (data) {
          var stats = algoliaSettings.labels.hits_stats
            .replace(/\$\{hits}/, data.nbHits)
            .replace(/\$\{time}/, data.processingTimeMS);
          return (stats);
        }
      }
    }),

    instantsearch.widgets.pagination({
      container: '#algolia-pagination',
      scrollTo: false,
      showFirstLast: false,
      labels: {
        first: '<i class="fa fa-angle-double-left"></i>',
        last: '<i class="fa fa-angle-double-right"></i>',
        previous: '<i class="fa fa-angle-left"></i>',
        next: '<i class="fa fa-angle-right"></i>'
      },
      cssClasses: {
        root: 'pagination',
        item: 'pagination-item',
        link: 'page-number',
        active: 'current',
        disabled: 'disabled-item'
      }
    })
  ].forEach(search.addWidget, search);

  search.start();

  $('.popup-trigger').click(function(e) {
    e.stopPropagation();
    $('body').append('<div class="popoverlay">').css('overflow', 'hidden');
    $('.popup').toggle();
    $('#algolia-search-input').find('input').focus();
  });

  $('.popup-btn-close').click(function(){
    $('.popup').hide();
    $('.popoverlay').remove();
    $('body').css('overflow', '');
  });

});
</script>

<script type="text/javascript">
  $(document).ready(function () {
    if ( $('#local-search-input').size() === 0) {
      return;
    }

    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = true;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = data.url;
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '' && data_content != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title < 0 && index_content < 0 ){
                      isMatch = false;
                    } else {
                      if (index_content < 0) {
                        index_content = 0;
                      }
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }
                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  });
</script>
    <div class="copyright">
    <div class="container">
        <div>
            <span>Copyright &copy; 2017 
            </span>
            <span>
                    <a href="//github.com/Xonlystar" class="copyright-links" target="_blank" rel="nofollow">Rain-web前端开发工程师</a> .All rights reserved.
            </span>  
        </div>
        <div>
            <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">
                        Hexo</a>
                        ,Hosted by <a href="https://pages.coding.me" class="copyright-links" target="_blank" rel="nofollow" style="font-weight: bold">Coding Pages</a>  
            </span>
        </div>
        <div>
            <span>
                    备案号
                    <a href="//icp.chinaz.com/info?q=onlystar.site" class="copyright-links" target="_blank" rel="nofollow">
                        鄂ICP备17004871号</a>
               
            </span> 
        </div>
    </div>
</div>

  <script src="/assets/highlight.pack.js?rev=@@hash"></script>
  <script>
    hljs.initHighlightingOnLoad(); //初始化代码高亮 
  </script>

<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>